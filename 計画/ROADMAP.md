# ast2graph プロジェクトロードマップ

## プロジェクト概要
PythonソースコードのAST（抽象構文木）をグラフ形式に変換する決定的処理ライブラリの開発

### 目標
- 300ファイル、総ASTノード数75,000-600,000を10分以内で処理
- メモリ使用量500MB以下
- 100%決定的処理（同一入力で同一出力）
- Pure Python実装（外部依存なし）

## 開発フェーズ

### Phase 1: 基本機能実装（2週間）

#### Week 1: コア機能開発
- [x] **データ構造の定義** `[優先度: 高]` ✅ 2025-07-02完了
  - [x] models.py - 基本データクラス（ASTGraphNode, ASTGraphEdge, EdgeType）
  - [x] graph_structure.py - グラフ管理クラス（GraphStructure, SourceInfo）
  - [ ] ~~batch_types.py - バッチ処理用データ型~~ [不要: バッチ処理実装時に作成]
  - [ ] ~~config.py - 設定データ型~~ [不要: 現時点では不要]
  - [x] exceptions.py - 例外階層の定義 ✅ 2025-07-03完了

- [x] **AST解析機能** `[優先度: 高]` ✅ 2025-07-03完了
  - [x] parser.py - AST解析機能の実装
  - [x] 構文エラーハンドリング
  - [x] エンコーディング対応

- [x] **グラフ構築機能** `[優先度: 高]` ✅ 2025-07-03完了
  - [x] graph_builder.py - グラフ構築機能
  - [x] ASTNodeVisitorクラスの実装
  - [x] 主要なASTノードタイプのサポート

#### Week 2: 高度な機能と統合
- [ ] **依存関係抽出** `[優先度: 中]`
  - [ ] dependency_extractor.py - 依存関係抽出機能
  - [ ] インポート文の解析
  - [ ] 関数・クラス参照の追跡

- [x] **エクスポート機能** `[優先度: 高]` ✅ 2025-07-03完了
  - [x] graph_exporter.py - エクスポート機能
  - [x] JSON形式へのシリアライズ
  - [x] エクスポートAPIの実装

- [x] **API設計** `[優先度: 高]` ✅ 2025-07-03完了
  - [x] 高レベルAPI（parse_file, parse_code, parse_directory）
  - [ ] 中レベルAPI（ASTProcessor, BatchProcessor）
  - [x] エラーハンドリングと例外階層

### Phase 2: 性能最適化とバッチ処理（2週間）

#### Week 3: バッチ処理と並列化
- [ ] **バッチ処理実装** `[優先度: 高]`
  - [ ] ファイル一括処理機能
  - [ ] プログレス監視
  - [ ] エラー発生ファイルの個別ハンドリング

- [ ] **並列処理実装** `[優先度: 高]`
  - [ ] マルチプロセシングによる並列化
  - [ ] スレッドセーフティの確保
  - [ ] リソース管理

#### Week 4: 最適化とストリーミング
- [ ] **メモリ最適化** `[優先度: 高]`
  - [ ] ストリーミング処理の実装
  - [ ] メモリ効率的なグラフ構築
  - [ ] 大規模ファイル対応

- [ ] **性能チューニング** `[優先度: 中]`
  - [ ] 効率的なAST走査アルゴリズム
  - [ ] キャッシング機構
  - [ ] プロファイリングと最適化

### Phase 3: 品質保証とドキュメント（1週間）

#### Week 5: テストとドキュメント
- [ ] **テスト実装** `[優先度: 高]`
  - [x] 単体テスト（parser, models） ✅ 2025-07-03完了
  - [x] 単体テスト（graph_builder） ✅ 2025-07-03完了
  - [x] 単体テスト（graph_exporter） ✅ 2025-07-03完了
  - [ ] 統合テスト（エンドツーエンド）
  - [ ] パフォーマンステスト
  - [ ] エッジケーステスト

- [ ] **ドキュメント作成** `[優先度: 中]`
  - [ ] APIリファレンス
  - [ ] 使用例とチュートリアル
  - [ ] アーキテクチャドキュメント

- [ ] **CLI実装** `[優先度: 低]`
  - [ ] コマンドラインインターフェース
  - [ ] 設定ファイルサポート

## 完了済みタスク
- [x] プロジェクト構造の初期化
- [x] pyproject.tomlの設定
- [x] 要件定義の作成
- [x] 各種計画書の作成

## 不要と判断されたタスク
- ~~LLM統合機能~~ （プロジェクトスコープ外）
- ~~データベース連携~~ （親プロジェクトの責務）
- ~~batch_types.py~~ （バッチ処理実装時に必要に応じて作成）
- ~~config.py~~ （現時点では設定管理の必要性なし）

## 追加すべき検討事項

### テスト修正タスク（緊急）
- [x] **テストとコード実装の不整合修正** `[優先度: 緊急]` ✅ 2025-07-03完了
  - [x] models.pyのテスト修正（42個のテストが失敗中）
  - [x] graph_structure.pyのテスト修正
  - [x] graph_builder.pyのテスト修正
  - [x] パラメータ名の統一（id vs node_id, properties vs metadataなど）

### 高レベルAPIの追加（完了）
- [x] **api.pyの実装** `[優先度: 高]` ✅ 2025-07-03完了
  - [x] parse_file() - 単一ファイルの解析
  - [x] parse_code() - 文字列コードの解析
  - [x] parse_directory() - ディレクトリ全体の解析
  - [x] ストリーミング対応のparse_files_stream()
  
- [ ] **統合テストの実装** `[優先度: 高]`
  - [ ] エンドツーエンドのワークフローテスト
  - [ ] 実際のPythonプロジェクトでのテスト
  - [ ] エラーケースの網羅的テスト

## その他の検討事項

- [ ] **エラーハンドリング戦略の実装** `[優先度: 高]`
  - [x] exceptions.pyで例外階層を定義済み
  - [ ] 各モジュールでの適切なエラーハンドリング実装
  - [ ] エラーレポーティング機能

- [ ] **プログレス監視機能** `[優先度: 中]`
  - [ ] 進捗状況のコールバック機構
  - [ ] 処理統計の収集と報告
  - [ ] キャンセル可能な処理の実装
- [ ] **セキュリティ対策** `[優先度: 中]`
  - [ ] 悪意のあるコードの検出
  - [ ] リソース制限の実装
  - [ ] サンドボックス環境での実行

- [ ] **監視とロギング** `[優先度: 低]`
  - [ ] 構造化ログの実装
  - [ ] メトリクス収集
  - [ ] デバッグモードの実装

- [x] **実装済み機能のテスト** `[優先度: 高]` ✅ 2025-07-03完了
  - [x] models.pyの単体テスト作成
  - [x] graph_structure.pyの単体テスト作成
  - [x] parser.pyの単体テスト作成
  - [x] エッジケースのテスト追加

- [x] **パーサー機能の詳細設計** `[優先度: 高]` ✅ 2025-07-03完了
  - [x] サポートするPythonバージョンの決定
  - [x] エラーリカバリー戦略の策定
  - [x] 大規模ファイル対応の考慮

- [x] **グラフ構築の詳細実装** `[優先度: 高]` ✅ 2025-07-03完了
  - [x] graph_builder.pyの基本実装
  - [x] ASTノードとグラフノードのマッピング
  - [x] エッジタイプの自動判定ロジック
  - [x] 依存関係の追跡メカニズム

## 成功指標
- ✅ AST→グラフ変換100%正確性
- ✅ 300ファイル/10分以内の処理速度
- ✅ メモリ使用量500MB以下
- ✅ 100%決定的動作

## 次のアクション
1. ~~データ構造（models.py）の実装から開始~~ ✅ 完了
2. ~~基本的なAST解析機能の実装~~ ✅ 完了
3. ~~グラフ構築機能（graph_builder.py）の実装~~ ✅ 完了
4. ~~最小限のテストケースの作成~~ ✅ 完了
5. ~~エクスポート機能の実装~~ ✅ 完了
6. ~~高レベルAPIの実装（parse_file, parse_code等）~~ ✅ 完了
7. ~~テストとコード実装の不整合修正~~ ✅ 完了
8. **依存関係抽出機能の設計と実装** ← 次の優先タスク
9. 統合テストの作成
10. APIドキュメントの作成

## 更新履歴
- 2025-07-02: 初版作成
- 2025-07-03: データ構造実装完了、追加検討事項追加
- 2025-07-03: AST解析機能（parser.py）実装完了
- 2025-07-03: テスト実装完了、グラフ構築タスク追加
- 2025-07-03: exceptions.py実装確認、次のアクション更新
- 2025-07-03: グラフ構築機能（graph_builder.py）実装完了
- 2025-07-03: エクスポート機能（graph_exporter.py）実装完了
- 2025-07-03: 高レベルAPI（api.py）実装完了、26個のテストすべて成功
- 2025-07-03: テスト実行確認、42個のテストが失敗中（models/graph_structure/graph_builder関連）
- 2025-07-03: テスト修正完了、全118個のテストが成功