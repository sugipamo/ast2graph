# CI/CDパイプライン設定計画

## 概要
ast2graphプロジェクトにGitHub Actionsを使用したCI/CDパイプラインを設定し、品質管理とリリースプロセスを自動化する。

## 目的
- コード品質の自動チェック
- テストの自動実行
- カバレッジレポートの生成
- パッケージの自動リリース
- 複数Python環境での互換性確認

## 実装計画

### 1. GitHub Actions基本設定
**ファイル**: `.github/workflows/ci.yml`

#### 1.1 テスト実行ワークフロー
- **トリガー**: プッシュ、プルリクエスト
- **Python versions**: 3.10, 3.11, 3.12
- **OS**: Ubuntu, Windows, macOS

```yaml
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        python-version: ["3.10", "3.11", "3.12"]
```

#### 1.2 必要なステップ
1. Checkout code
2. Setup Python
3. Install dependencies
4. Run linter (flake8/ruff)
5. Run type checker (mypy)
6. Run tests with coverage
7. Upload coverage reports

### 2. コード品質チェック
**ファイル**: `.github/workflows/quality.yml`

#### 2.1 Linting
- `ruff`または`flake8`によるコードスタイルチェック
- `black`によるフォーマットチェック
- `isort`によるインポート順序チェック

#### 2.2 Type Checking
- `mypy`による型チェック
- 厳格モード設定

### 3. カバレッジレポート
#### 3.1 pytest-cov設定
- カバレッジ閾値: 90%以上
- HTMLレポート生成
- Codecovへのアップロード

#### 3.2 カバレッジバッジ
- README.mdへのバッジ追加
- Codecov統合

### 4. リリース自動化
**ファイル**: `.github/workflows/release.yml`

#### 4.1 リリースワークフロー
- タグプッシュでトリガー
- PyPIへの自動公開
- GitHub Releasesの作成
- Changelog自動生成

#### 4.2 バージョニング
- Semantic Versioning (SemVer)
- `bump2version`または`poetry-dynamic-versioning`使用

### 5. 追加の自動化

#### 5.1 依存関係更新
- Dependabotの設定
- 月次でのアップデート確認

#### 5.2 セキュリティスキャン
- CodeQLによる脆弱性スキャン
- 依存関係の脆弱性チェック

#### 5.3 ドキュメント生成
- Sphinxによるドキュメント自動生成
- GitHub Pagesへの自動デプロイ

## 実装手順

### Step 1: 基本的なCI設定
1. `.github/workflows/ci.yml`作成
2. 基本的なテスト実行フロー構築
3. マトリックステストの確認

### Step 2: コード品質ツール統合
1. `pyproject.toml`にツール設定追加
2. pre-commitフック設定
3. 品質チェックワークフロー追加

### Step 3: カバレッジ設定
1. pytest-cov設定
2. Codecov統合
3. バッジ追加

### Step 4: リリース自動化
1. PyPI認証情報設定（Secrets）
2. リリースワークフロー作成
3. 初回リリーステスト

### Step 5: 追加機能
1. Dependabot設定
2. セキュリティスキャン有効化
3. ドキュメント自動化

## 必要な設定ファイル

### 1. `.github/workflows/ci.yml`
メインのCIパイプライン設定

### 2. `.github/workflows/release.yml`
リリース自動化設定

### 3. `.github/dependabot.yml`
依存関係自動更新設定

### 4. `pyproject.toml`の更新
- ツール設定セクション追加
- カバレッジ設定
- リンター設定

### 5. `.pre-commit-config.yaml`
pre-commitフック設定

## 成功指標
- ✅ 全てのコミットでテスト自動実行
- ✅ カバレッジ90%以上の維持
- ✅ コード品質チェックの自動化
- ✅ タグプッシュでの自動リリース
- ✅ ドキュメントの自動更新

## 優先順位
1. **高**: 基本的なテスト実行CI
2. **高**: カバレッジレポート
3. **中**: コード品質チェック
4. **中**: リリース自動化
5. **低**: ドキュメント自動化

## 見積もり工数
- 基本CI設定: 1時間
- 品質チェック統合: 1時間
- カバレッジ設定: 30分
- リリース自動化: 2時間
- 追加機能: 1時間

合計: 約5.5時間

## リスクと対策
- **リスク**: 異なるOS間での互換性問題
  - **対策**: マトリックステストで早期発見
- **リスク**: PyPIトークンの管理
  - **対策**: GitHub Secretsの適切な設定
- **リスク**: テスト時間の増大
  - **対策**: 並列実行とキャッシュ活用

## 次のステップ
1. `.github/workflows/`ディレクトリ作成
2. 基本的な`ci.yml`ファイル作成
3. テスト実行の確認
4. 段階的に機能追加