# AST解析機能実装計画

## 実施日時
2025年7月3日 00:36

## 目的
PythonソースコードからASTを解析し、グラフ構造に変換するための基盤となるparser.pyを実装する

## 前提条件
- models.pyとgraph_structure.pyが実装済み
- 基本的なデータ構造が定義されている
- exceptions.pyが実装済み

## 実装対象
### 1. parser.py
- ASTParser クラス
- ソースコード解析機能
- エラーハンドリング
- エンコーディング自動検出

### 2. サポートする機能
- Python 3.8以上のAST解析
- 構文エラーのリカバリー
- 複数のエンコーディング対応（UTF-8, Shift-JIS等）
- 大規模ファイルの効率的な処理

## 実装手順

### ステップ1: ASTParserクラスの基本実装
1. parse_file メソッド
   - ファイルパスからソースコードを読み込み
   - エンコーディング検出
   - AST生成
2. parse_code メソッド
   - 文字列からAST生成
   - エラーハンドリング

### ステップ2: エラーハンドリングの実装
1. 構文エラーの処理
   - SyntaxErrorをキャッチし、詳細情報を保持
   - 部分的な解析結果の返却
2. ファイル読み込みエラーの処理
   - FileNotFoundError
   - PermissionError
   - EncodingError

### ステップ3: エンコーディング検出機能
1. chardetライブラリを使わない実装（Pure Python）
2. BOM検出
3. coding宣言の解析
4. フォールバック処理

### ステップ4: 解析結果の構造化
1. ParseResultクラスの定義
   - AST
   - ソース情報
   - エラー情報
2. メタデータの収集
   - ファイルサイズ
   - 行数
   - ハッシュ値

### ステップ5: パフォーマンス最適化
1. 大規模ファイル対応
   - メモリ効率的な読み込み
   - 必要に応じたストリーミング処理の検討
2. キャッシング機能の検討
   - 解析結果のキャッシュ
   - ハッシュベースの重複検出

## 検証項目
- [ ] 基本的なPythonファイルが解析できる
- [ ] 構文エラーがあるファイルでも部分的に解析できる
- [ ] 各種エンコーディングのファイルが読み込める
- [ ] 大規模ファイル（10MB以上）が処理できる
- [ ] メモリ使用量が適切に管理されている

## 期待される成果
- 堅牢なAST解析機能
- エラーに強い実装
- 様々なPythonファイルに対応可能
- 後続のグラフ構築処理への入力準備

## 技術的考慮事項
1. Python標準ライブラリのastモジュールを使用
2. typingモジュールによる型ヒント
3. dataclassesによるデータ構造定義
4. 例外階層の適切な使用

## テスト計画
1. 正常系テスト
   - 単純なPythonファイル
   - 複雑な構文を含むファイル
   - 大規模ファイル
2. 異常系テスト
   - 構文エラーファイル
   - 存在しないファイル
   - 読み込み権限なしファイル
   - 不正なエンコーディング

## 次のステップ
parser.pyの実装が完了したら、graph_builder.pyの実装に進む