# テストとコード実装の不整合修正計画

## 概要
現在、119個のテストのうち42個が失敗している状態です。主にmodels.py、graph_structure.py、graph_builder.pyのテストが、実装されたコードとパラメータ名や動作が異なることが原因です。

## 現状分析

### 失敗しているテストの内訳
1. **models.py関連**: ASTGraphNodeとASTGraphEdgeのパラメータ名不一致
   - テストは`id`を期待、実装は`node_id`/`edge_id`を使用
   - テストは`properties`を期待、実装は`metadata`を使用
   - テストは`source_node_id`を期待、実装は`source_id`を使用

2. **graph_structure.py関連**: GraphStructureクラスのメソッド実装不足
   - add_node, add_edge, get_nodeなどの基本メソッドが未実装

3. **graph_builder.py関連**: グラフ構築ロジックの不整合
   - エッジ作成ロジックの問題
   - ソース情報の伝播処理の問題

## 修正方針

### 優先度1: 実装とテストの調整
テストが期待する仕様に合わせて実装を修正するか、実装に合わせてテストを修正するかを決定する必要があります。

**推奨**: 現在の実装は適切な設計に基づいているため、テストを実装に合わせて修正

### 修正手順

1. **models.pyのテスト修正**
   - `id` → `node_id`/`edge_id`
   - `properties` → `metadata`
   - `source_node_id`/`target_node_id` → `source_id`/`target_id`
   - その他のパラメータ名の統一

2. **graph_structure.pyの実装確認と修正**
   - 基本的なグラフ操作メソッドの実装確認
   - 不足しているメソッドの実装追加

3. **graph_builder.pyのロジック修正**
   - エッジ作成処理の修正
   - ソース情報の正確な伝播
   - エラーハンドリングの改善

4. **統合テストの実行**
   - すべてのテストが成功することを確認
   - パフォーマンステストの実行

## 期待される成果
- すべてのテスト（119個）が成功する
- コードとテストの整合性が保たれる
- APIの一貫性が向上する

## リスクと対策
- **リスク**: 既存のAPIを使用している場合の互換性問題
- **対策**: 現時点では外部利用者がいないため、早期の修正が望ましい

## タイムライン
- 見積もり時間: 2-3時間
- 優先度: 緊急（次の機能開発前に完了必須）

## 次のステップ
このタスク完了後、依存関係抽出機能（dependency_extractor.py）の実装に進む。