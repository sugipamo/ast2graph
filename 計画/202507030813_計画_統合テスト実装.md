# 統合テスト実装計画

## 概要
ast2graphプロジェクトの統合テストを実装し、エンドツーエンドのワークフローを検証する。

## 背景
- Phase 1の基本機能実装が完了（141個のユニットテスト全成功）
- 各モジュールは個別にテスト済みだが、実際のワークフローでの統合動作確認が必要
- ROADMAPで次の優先タスクとして位置づけられている

## 目標
1. エンドツーエンドのワークフローテスト実装
2. 実際のPythonプロジェクトでのテスト
3. エラーケースの網羅的テスト
4. パフォーマンステストの基礎実装

## 実装計画

### 1. テストディレクトリ構造の整備
```
tests/
├── unit/          # 既存（実装済み）
├── integration/   # 新規作成
│   ├── __init__.py
│   ├── test_end_to_end.py
│   ├── test_real_projects.py
│   ├── test_error_scenarios.py
│   └── test_performance.py
└── fixtures/      # テスト用データ
    ├── sample_projects/
    └── error_cases/
```

### 2. エンドツーエンドテスト（test_end_to_end.py）
- **単一ファイル処理フロー**
  - ファイル読み込み → AST解析 → グラフ構築 → エクスポート
  - 依存関係抽出を含むフロー
  
- **ディレクトリ処理フロー**
  - parse_directory()の実際の動作確認
  - 複数ファイル間の依存関係解析
  
- **ストリーミング処理フロー**
  - parse_files_stream()のメモリ効率確認
  - 大量ファイル処理のシミュレーション

### 3. 実プロジェクトテスト（test_real_projects.py）
- **小規模プロジェクト（5-10ファイル）**
  - 簡単なPythonパッケージ構造
  - import文の解決確認
  
- **中規模プロジェクト（50-100ファイル）**
  - 実際のオープンソースプロジェクトのサブセット
  - 複雑な依存関係の検証

### 4. エラーシナリオテスト（test_error_scenarios.py）
- **構文エラーを含むファイル**
  - エラーハンドリングの確認
  - 部分的な解析結果の検証
  
- **エンコーディング問題**
  - 様々なエンコーディングのファイル
  - 混在環境での動作確認
  
- **循環参照**
  - 循環importの検出と処理
  
- **大規模ファイル**
  - メモリ制限内での処理確認

### 5. パフォーマンステスト（test_performance.py）
- **処理速度測定**
  - 300ファイル/10分の目標達成確認
  - ボトルネック特定
  
- **メモリ使用量測定**
  - 500MB以下の目標確認
  - メモリリークの検出
  
- **決定性確認**
  - 同一入力での出力一致性検証

## 実装優先順位
1. エンドツーエンドテスト（基本フロー）
2. エラーシナリオテスト
3. 実プロジェクトテスト
4. パフォーマンステスト

## 成功指標
- 統合テストのカバレッジ90%以上
- 実プロジェクトでの動作確認3件以上
- パフォーマンス目標の達成確認
- CI/CDパイプラインへの統合

## タイムライン
- Day 1-2: エンドツーエンドテスト実装
- Day 3: エラーシナリオテスト実装
- Day 4: 実プロジェクトテスト実装
- Day 5: パフォーマンステスト実装・最適化

## 備考
- 既存のユニットテストとの重複を避ける
- 実際の使用シナリオに即したテストケース設計
- パフォーマンステストは継続的に実行可能な形で実装